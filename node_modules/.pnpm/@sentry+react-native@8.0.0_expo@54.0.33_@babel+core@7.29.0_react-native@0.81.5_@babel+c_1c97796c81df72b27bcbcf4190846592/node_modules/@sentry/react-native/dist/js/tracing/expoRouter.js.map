{"version":3,"file":"expoRouter.js","sourceRoot":"","sources":["../../../src/js/tracing/expoRouter.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,iBAAiB,EAAE,cAAc,EAAE,iBAAiB,EAAE,MAAM,cAAc,CAAC;AACpF,OAAO,EAAE,qCAAqC,EAAE,MAAM,UAAU,CAAC;AAcjE;;;;;;;;;GASG;AACH,MAAM,UAAU,cAAc,CAAuB,MAAS;IAC5D,IAAI,CAAC,CAAA,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,QAAQ,CAAA,EAAE;QACrB,OAAO,MAAM,CAAC;KACf;IAED,oDAAoD;IACpD,IAAK,MAAoD,CAAC,uBAAuB,EAAE;QACjF,OAAO,MAAM,CAAC;KACf;IAED,MAAM,gBAAgB,GAAG,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IAEtD,MAAM,CAAC,QAAQ,GAAG,CAAC,CAAC,IAAwD,EAAE,EAAE;QAC9E,sDAAsD;QACtD,IAAI,SAAS,GAAG,SAAS,CAAC;QAC1B,IAAI,OAAO,IAAI,KAAK,QAAQ,EAAE;YAC5B,SAAS,GAAG,IAAI,CAAC;SAClB;aAAM,IAAI,IAAI,IAAI,OAAO,IAAI,KAAK,QAAQ,IAAI,UAAU,IAAI,IAAI,IAAI,IAAI,CAAC,QAAQ,EAAE;YAClF,SAAS,GAAG,IAAI,CAAC,QAAQ,CAAC;SAC3B;QAED,MAAM,IAAI,GAAG,iBAAiB,CAAC;YAC7B,EAAE,EAAE,qBAAqB;YACzB,IAAI,EAAE,YAAY,SAAS,EAAE;YAC7B,UAAU,EAAE;gBACV,eAAe,EAAE,qCAAqC;gBACtD,YAAY,EAAE,OAAO,IAAI,KAAK,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC;gBACpE,YAAY,EAAE,SAAS;aACxB;SACF,CAAC,CAAC;QAEH,IAAI;YACF,MAAM,MAAM,GAAG,gBAAgB,CAAC,IAAI,CAAC,CAAC;YAEtC,8CAA8C;YAC9C,IAAI,MAAM,IAAI,OAAO,MAAM,KAAK,QAAQ,IAAI,MAAM,IAAI,MAAM,IAAI,OAAO,MAAM,CAAC,IAAI,KAAK,UAAU,EAAE;gBACjG,OAAO,MAAM;qBACV,IAAI,CAAC,GAAG,CAAC,EAAE;oBACV,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,SAAS,CAAC,EAAE,IAAI,EAAE,cAAc,EAAE,CAAC,CAAC;oBAC1C,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,GAAG,EAAE,CAAC;oBACZ,OAAO,GAAG,CAAC;gBACb,CAAC,CAAC;qBACD,KAAK,CAAC,CAAC,KAAc,EAAE,EAAE;oBACxB,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,SAAS,CAAC,EAAE,IAAI,EAAE,iBAAiB,EAAE,OAAO,EAAE,MAAM,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;oBACrE,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,GAAG,EAAE,CAAC;oBACZ,MAAM,KAAK,CAAC;gBACd,CAAC,CAAC,CAAC;aACN;iBAAM;gBACL,yBAAyB;gBACzB,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,SAAS,CAAC,EAAE,IAAI,EAAE,cAAc,EAAE,CAAC,CAAC;gBAC1C,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,GAAG,EAAE,CAAC;gBACZ,OAAO,MAAM,CAAC;aACf;SACF;QAAC,OAAO,KAAK,EAAE;YACd,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,SAAS,CAAC,EAAE,IAAI,EAAE,iBAAiB,EAAE,OAAO,EAAE,MAAM,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;YACrE,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,GAAG,EAAE,CAAC;YACZ,MAAM,KAAK,CAAC;SACb;IACH,CAAC,CAA+B,CAAC;IAEjC,6CAA6C;IAC5C,MAAoD,CAAC,uBAAuB,GAAG,IAAI,CAAC;IAErF,OAAO,MAAM,CAAC;AAChB,CAAC","sourcesContent":["import { SPAN_STATUS_ERROR, SPAN_STATUS_OK, startInactiveSpan } from '@sentry/core';\nimport { SPAN_ORIGIN_AUTO_EXPO_ROUTER_PREFETCH } from './origin';\n\n/**\n * Type definition for Expo Router's router object\n */\nexport interface ExpoRouter {\n  prefetch?: (href: string | { pathname?: string; params?: Record<string, unknown> }) => void | Promise<void>;\n  // Other router methods can be added here if needed\n  push?: (...args: unknown[]) => void;\n  replace?: (...args: unknown[]) => void;\n  back?: () => void;\n  navigate?: (...args: unknown[]) => void;\n}\n\n/**\n * Wraps Expo Router. It currently only does one thing: extends prefetch() method\n * to add automated performance monitoring.\n *\n * This function instruments the `prefetch` method of an Expo Router instance\n * to create performance spans that measure how long route prefetching takes.\n *\n * @param router - The Expo Router instance from `useRouter()` hook\n * @returns The same router instance with an instrumented prefetch method\n */\nexport function wrapExpoRouter<T extends ExpoRouter>(router: T): T {\n  if (!router?.prefetch) {\n    return router;\n  }\n\n  // Check if already wrapped to avoid double-wrapping\n  if ((router as T & { __sentryPrefetchWrapped?: boolean }).__sentryPrefetchWrapped) {\n    return router;\n  }\n\n  const originalPrefetch = router.prefetch.bind(router);\n\n  router.prefetch = ((href: Parameters<NonNullable<ExpoRouter['prefetch']>>[0]) => {\n    // Extract route name from href for better span naming\n    let routeName = 'unknown';\n    if (typeof href === 'string') {\n      routeName = href;\n    } else if (href && typeof href === 'object' && 'pathname' in href && href.pathname) {\n      routeName = href.pathname;\n    }\n\n    const span = startInactiveSpan({\n      op: 'navigation.prefetch',\n      name: `Prefetch ${routeName}`,\n      attributes: {\n        'sentry.origin': SPAN_ORIGIN_AUTO_EXPO_ROUTER_PREFETCH,\n        'route.href': typeof href === 'string' ? href : JSON.stringify(href),\n        'route.name': routeName,\n      },\n    });\n\n    try {\n      const result = originalPrefetch(href);\n\n      // Handle both promise and synchronous returns\n      if (result && typeof result === 'object' && 'then' in result && typeof result.then === 'function') {\n        return result\n          .then(res => {\n            span?.setStatus({ code: SPAN_STATUS_OK });\n            span?.end();\n            return res;\n          })\n          .catch((error: unknown) => {\n            span?.setStatus({ code: SPAN_STATUS_ERROR, message: String(error) });\n            span?.end();\n            throw error;\n          });\n      } else {\n        // Synchronous completion\n        span?.setStatus({ code: SPAN_STATUS_OK });\n        span?.end();\n        return result;\n      }\n    } catch (error) {\n      span?.setStatus({ code: SPAN_STATUS_ERROR, message: String(error) });\n      span?.end();\n      throw error;\n    }\n  }) as NonNullable<T['prefetch']>;\n\n  // Mark as wrapped to prevent double-wrapping\n  (router as T & { __sentryPrefetchWrapped?: boolean }).__sentryPrefetchWrapped = true;\n\n  return router;\n}\n"]}